---
title: "The Office Line-Analysis"
format: html
knitr:
  opts_chunk:
    warning: false
output:
  html_document:
    code_folding: hide
---

```{r, message=FALSE}
#| echo: false
library(readr)
the_office_lines <- read_csv("the-office_lines.csv")
```

```{r, message=FALSE}
#| echo: false
library(tidyverse)
```

```{r, message=FALSE}
top_characters <- the_office_lines |>
  group_by(Character) |>
  summarize(total_count = n(), .groups = "drop") |>
  slice_max(total_count, n = 10)

lines_per_season <- the_office_lines |>
  filter(Character %in% top_characters$Character) |>
  group_by(Character, Season, add = TRUE) |>
  summarize(appearences = n(), .groups = "drop") |>
  group_by(Season) |>
  mutate(total_season = sum(appearences)) |>
  ungroup() |>
  mutate(percent = (appearences/total_season)*100)

ggplot(lines_per_season, aes(x = Season, y = percent, color = Character)) +
  geom_point() +
  geom_line() +
  scale_y_continuous(labels = function(x) paste0(x, "%")) +
  labs(
    x = "Season",
    y = "Percentage",
    title = "Line Breakdown Per Season"
  ) +
  theme(
    axis.text.x = element_text(size = 14),
    axis.text.y = element_text(size = 14), 
    axis.title.x = element_text(size = 15),
    axis.title.y = element_text(size = 15),
    plot.title = element_text(size = 18, face = "bold")
  )
```

This graph above shows the distribution of lines characters have each season of the show. The graph shows the 10 characters with the highest total lines in the show. As you can see Micheal dominates the share of lines through his time with the office. As he leaves following season 8, you see a jump in other characters roles as they needed to fill the gap that Michael left. This graph shows the importance that he had to the show.


```{r}
thats_what_she_said <- the_office_lines |>
  mutate(lower_lines = str_to_lower(Line)) |>
  mutate(quote = str_extract(lower_lines, "that’s what she said")) |>
  filter(!is.na(quote)) |>
  mutate(season_text = str_c(Season)) |>
  group_by(season_text) |>
  summarize(count = n(), .groups = "drop") |>
  add_row(count = 0, season_text = "1") |>
  add_row(count = 0, season_text = "8")

ggplot(thats_what_she_said, aes(x = season_text, y = count)) +
  geom_col() +
  labs(
    x = "Season",
    y = "Quantity of Jokes",
    title = "That's What She Said Jokes a Season"
  ) +
  theme(
    axis.text.x = element_text(size = 14),
    axis.text.y = element_text(size = 14), 
    axis.title.x = element_text(size = 15),
    axis.title.y = element_text(size = 15),
    plot.title = element_text(size = 18, face = "bold")
  )
```

The chart above shows the quantity of "that's what she said" jokes there are through the show, broken down by season. As you can see in the chart, they created the joke starting in season 2 and slowly declined in use as the show went on before michael's departure in season 7. There is a return in season 9, likely due to Michael's return for the finale.


```{r}
words_preceding_she_said <- the_office_lines |>
  mutate(lower_case = str_to_lower(Line)) |>
  mutate(char_following = str_extract(lower_case, "(?<=that’s what she said).")) |>
  filter(!is.na(char_following)) |>
  group_by(char_following) |>
  summarize(count = n())
  
ggplot(words_preceding_she_said, aes(x = char_following, y = count, text = char_following)) +
  geom_col() +
  labs(
    x = "Character following",
    y = "Appearences",
    title = 'Character following "Thats what she said"'
  ) +
  theme(
    axis.text.x = element_text(size = 17, face = "bold"),
    axis.text.y = element_text(size = 14),
    axis.title.x = element_text(size = 16),
    axis.title.y = element_text(size = 16),
    plot.title = element_text(size = 18, face = "bold")
  )
```

The chart above builds upon the previous chart. This breaks down how the characters used following the "that's what she said joke". This is able to tell us how the joke was presented. For example, we are able to figure out that more often than not, the joke is not written as Michael screaming out "That's what she said!", rather he delivers it less excited. You are also able to see that it is written in other ways as well such as the ', which is a line where Jim quotes the joke inside of a question.





